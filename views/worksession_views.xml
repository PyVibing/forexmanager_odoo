<?xml version="1.0" encoding="UTF-8"?>

<odoo>
    <!-- Form view of forexmanager.worksession -->
    <record id="forexmanager_worksession_form_view" model="ir.ui.view">
        <field name="name">ForexManager worksession form view</field>
        <field name="model">forexmanager.worksession</field>
        <field name="arch" type="xml">
            <form create="false">
                <style>
                    .o_form_button_save.btn-light {
                        display: none;
                    }

                    .operation-card {
                        flex: 1;
                        min-width: 200px;
                        max-width: 900px;
                        margin: 20px auto;
                        padding: 20px;
                        background-color: #ffffff;
                        border-radius: 10px;
                        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
                        border-left: 5px solid #007bff;
                    }

                    .section {
                        margin-bottom: 20px;
                    }

                    .section-title {
                        font-size: 16px;
                        font-weight: 700;
                        color: #007bff;
                        text-align: center;
                        margin-bottom: 10px;
                        display: block;
                    }

                    .group {
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                    }

                    .field-row {
                        display: flex;
                        flex-direction: column;
                    }

                    label {
                        font-weight: 600;
                        color: #444;
                        margin-bottom: 4px;
                    }

                    .field-input {
                        border: 1px solid #ccc;
                        border-radius: 6px;
                        padding: 6px 10px;
                        min-height: 30px;
                        width: 100%;
                    }

                    .main-title {
                        text-align: center;
                        font-size: 20px;
                        font-weight: 800;
                        color: #fff;
                        background: linear-gradient(135deg, #007bff, #0056b3);
                        padding: 10px 0;
                        border-radius: 8px;
                        margin-bottom: 20px;
                    }

                    .error-message {
                        display:flex;
                        justify-content:center;
                        width:100%;
                        background-color: #a72828ff;
                        border-radius:8px;
                        padding:12px 16px; 
                        align-items:center; 
                        gap:10px;
                        color: #fcfcfcff; 
                        font-weight:600; 
                        font-size:16px;
                    }

                    /* âœ… Mantener el diseÃ±o especial de los botones del field Selection */
                    .session-type-buttons .o_radio_input {
                        display: none !important;
                    }

                    .session-type-buttons {
                        display: inline-flex;
                        justify-content: center;
                        gap: 15px;
                    }

                    .session-type-buttons .o_radio_item label {
                        display: inline-block;
                        padding: 12px 24px;
                        margin: 5px;
                        border: 2px solid #007bff;
                        border-radius: 25px;
                        cursor: pointer;
                        background-color: #f8f9fa;
                        font-weight: 600;
                        color: #007bff;
                        transition: all 0.2s ease-in-out;
                        text-align: center;
                    }

                    .o_button_box {
                        display: flex !important;
                        flex-wrap: wrap;
                        justify-content: center; /* âœ… centra horizontal */
                        gap: 10px;
                        margin-top: 10px;
                    }

                    .session-type-buttons {
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        width: 100%;
                        gap: 15px;
                    }

                    .session-type-buttons .o_radio_input:checked + label {
                        background-color: #007bff;
                        color: #fff;
                        border-color: #0056b3;
                    }

                    .no-dif-check {
                        background: linear-gradient(135deg, #28a745, #218838);
                        color: #fff;
                        font-weight: 700;
                        font-size: 16px;
                        padding: 14px 20px;
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 10px;
                        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }

                    .dif-check {
                        background: linear-gradient(135deg, #dc3545, #a71d2a);
                        color: #fff;
                        font-weight: 700;
                        font-size: 16px;
                        padding: 14px 20px;
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 10px;
                        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                </style>

                <sheet>
                    <div invisible="desk_id">
                        <span class="error-message">No has vinculado ninguna ventanilla. Ve al menÃº VINCULAR VENTANILLA y hazlo, para que puedas gestionar tu sesiÃ³n de trabajo.</span>
                    </div>

                    <div class="operation-card" invisible="not desk_id">

                        <!-- ðŸ”¹ MAIN FIELD -->
                        <div class="section">
                            <div class="main-title">SESIÃ“N DE ENTRADA/SALIDA</div>
                            <div class="field-row session-type-buttons">
                                <field name="session_type" widget="radio" options="{'horizontal': true}" readonly="id"/>
                            </div>
                        </div>

                        <!-- ðŸ”¹ READONLY FIELDS -->
                        <div class="section">
                            <span class="section-title">INFORMACIÃ“N DE LA SESIÃ“N</span>
                            <div class="group">
                                <div class="field-row">
                                    <label for="name"/>
                                    <field name="name" readonly="1" class="field-input" force_save="1"/>
                                </div>

                                <div class="field-row">
                                    <label for="user_id"/>
                                    <field name="user_id" force_save="1" options="{'no_create': True, 'no_open': True}" readonly="1" class="field-input"/>
                                </div>

                                <div class="field-row">
                                    <label for="desk_id"/>
                                    <field name="desk_id" force_save="1" options="{'no_open': True}" class="field-input"/>
                                </div>

                                <div class="field-row">
                                    <label for="opening_desk_id"/>
                                    <field name="opening_desk_id" force_save="1" options="{'no_create': True, 'no_open': True}" readonly="1" class="field-input"/>
                                </div>

                                <div class="field-row">
                                    <label for="session_status"/>
                                    <field name="session_status" force_save="1" class="field-input"/>
                                </div>

                                <div class="field-row" invisible="not start_time">
                                    <label for="start_time"/>
                                    <field name="start_time" force_save="1" readonly="1" class="field-input"/>
                                </div>

                                <div class="field-row" invisible="not close_time">
                                    <label for="close_time"/>
                                    <field name="close_time" force_save="1" readonly="1" class="field-input"/>
                                </div>

                                <div class="field-row" invisible="session_type != 'checkin' or not closing_session">
                                    <label for="closing_session"/>
                                    <field name="closing_session" force_save="1" class="field-input" readonly="1"/>
                                </div>

                                <div class="field-row" invisible="session_type != 'checkout' or not session_to_close">
                                    <label for="session_to_close"/>
                                    <field name="session_to_close" force_save="1" class="field-input" readonly="1"/>
                                </div>
                            </div>
                        </div>

                        <!-- ðŸ”¹ Checkbalance status -->
                        <div class="section" invisible="not balances_checked_ended or saved_difference_checkbalance_ids">
                            <div style="display:flex; justify-content:center; width:100%; margin-bottom:20px;">
                                <div class="no-dif-check">
                                    <i class="fa fa-check-square"></i>
                                    <span>Arqueo completado sin diferencias</span>
                                </div>
                            </div>
                        </div>
                        <div class="section" invisible="not saved_difference_checkbalance_ids">
                            <div style="display:flex; justify-content:center; width:100%; margin-bottom:20px;">
                                <div class="dif-check">
                                    <i class="fa fa-check-square"></i>
                                    <span>Arqueo completado con diferencias</span>
                                </div>
                            </div>
                            <div>
                                <field name="diff_summary" readonly="1" widget="html" force_save="1"/>
                            </div>
                        </div>
                    </div>

                    <!-- ðŸ”¹ Buttons conservan estilo de Bootstrap -->
                    <div class="section">
                        <div class="o_button_box" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;">
                            <div invisible="session_type != 'checkin' or not desk_id or id">
                                <button name="launch_create" string="INICIAR SESIÃ“N" type="object" class="btn btn-success"/>
                            </div>

                            <div invisible="session_type != 'checkout' or not desk_id or id">
                                <button name="launch_create" string="FINALIZAR SESIÃ“N" type="object" class="btn btn-danger"/>
                            </div>

                            <div invisible="session_type != 'checkin' or not id or opening_desk_id != desk_id or balances_checked_started">
                                <button name="start_checkbalance" string="INICIAR ARQUEO DE ENTRADA" type="object" class="btn btn-warning"/>
                            </div>

                            <div invisible="session_type != 'checkout' or not id or opening_desk_id != desk_id or balances_checked_started">
                                <button name="start_checkbalance" string="INICIAR ARQUEO DE SALIDA" type="object" class="btn btn-warning"/>
                            </div>

                            <div invisible="not checkbalance_ids or (not pending_checkbalance_ids and not difference_checkbalance_ids)">
                                <button name="search_difference" string="BUSCAR DIFERENCIAS" type="object" class="btn btn-warning"/>
                            </div>

                            <div invisible="not difference_checkbalance_ids">
                                <button name="confirm_balances" string="CONFIRMAR ARQUEO" type="object"
                                        class="btn btn-danger" confirm="Â¿Seguro que quieres confirmar el arqueo?"/>
                            </div>
                        </div>
                    </div>

                    <!-- Notebook -->
                    <div>
                        <notebook invisible="not pending_checkbalance_ids and not difference_checkbalance_ids">
                            <page string="Pendiente de arqueo" invisible="not pending_checkbalance_ids">
                                <field name="pending_checkbalance_ids">
                                    <list editable="top" create="false" delete="false" options="{'no_open': True}">
                                        <field name="name"/>
                                        <field name="session_id" options="{'no_open': True}"/>
                                        <field name="user_id" options="{'no_open': True}"/>
                                        <field name="desk_id" options="{'no_open': True}"/>
                                        <field name="currency_id" options="{'no_open': True}"/>
                                        <field name="physical_balance"/>
                                        <field name="BD_balance"/>
                                        <field name="difference"/>
                                        <field name="checked"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Diferencias en el arqueo" invisible="not difference_checkbalance_ids">
                                <field name="difference_checkbalance_ids">
                                    <list editable="top" create="false" delete="false">
                                        <field name="name"/>
                                        <field name="session_id" options="{'no_open': True}"/>
                                        <field name="user_id" options="{'no_open': True}"/>
                                        <field name="desk_id" options="{'no_open': True}"/>
                                        <field name="currency_id" options="{'no_open': True}"/>
                                        <field name="physical_balance" widget="char"/>
                                        <field name="BD_balance"/>
                                        <field name="difference"/>
                                        <field name="checked"/>
                                    </list>
                                </field>
                            </page>
                        </notebook>
                    </div>
                </sheet>
            </form>

        </field>
    </record>

    <!-- List view of forexmanager.worksession -->
    <record id="forexmanager_worksession_list_view" model="ir.ui.view">
        <field name="name">ForexManager worksession list view</field>
        <field name="model">forexmanager.worksession</field>
        <field name="arch" type="xml">
            <list delete="0" duplicate="0" decoration-success="desk_id == opening_desk_id" decoration-warning="desk_id != opening_desk_id">
                <field name="id" width="5"/>
                <field name="name" width="400"/>
                <field name="desk_id" width="50" string="Ventanilla/sesiÃ³n" />
                <field name="opening_desk_id" width="50" string="Ventanilla/arqueo"/>
                <field name="session_type" string="Tipo" width="20"/>
                <field name="session_status" string="Estado" width="20"/>
                <field name="session_to_close" width="100"/>
                <field name="closing_session" width="100"/>
                <field name="start_time" string="Inicio" width="20"/>
                <field name="close_time" string="Cierre" width="20"/>
                <field name="balances_checked_ended" width="30"/>
            </list>
        </field>
    </record>

    <!-- Search view of forexmanager.worksession-->
     <record id="forexmanager_worksession_search_view" model="ir.ui.view">
        <field name="name">ForexManager worksession search view</field>
        <field name="model">forexmanager.worksession</field>
        <field name="arch" type="xml">
            <search>
                <field name="id"/>
                <field name="name"/>
                <field name="desk_id"/>
                <field name="opening_desk_id"/>
                <field name="session_type"/>
                <field name="session_status"/>
                <field name="session_to_close"/>
                <field name="closing_session"/>
            </search>
        </field>
    </record>

    <!-- Action of forexmanager.currency -->
    <record id="forexmanager_worksession_action" model="ir.actions.act_window">
        <field name="name">SESIÃ“N / ARQUEO</field>
        <field name="res_model">forexmanager.worksession</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[
            ("user_id", "=", uid), 
            ("session_status", "=", "open"),
            ]</field>
    </record>
</odoo>