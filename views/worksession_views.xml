<?xml version="1.0" encoding="UTF-8"?>

<odoo>
    <!-- Form view of forexmanager.worksession -->
    <record id="forexmanager_worksession_form_view" model="ir.ui.view">
        <field name="name">ForexManager worksession form view</field>
        <field name="model">forexmanager.worksession</field>
        <field name="arch" type="xml">
            <form create="false">
                <style>
                    .o_form_button_save.btn-light {
                        display: None;
                    }
                    
                    .session-card {
                        flex: 1;
                        min-width: 320px;
                        padding: 15px;
                        background-color: #ffffff;
                        border-radius: 8px;
                        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
                        border-left: 4px solid #007bff;
                        margin-bottom: 15px;
                        max-width: 75%;
                    }

                    .section {
                        margin-bottom: 20px;
                        border-bottom: 1px solid #e0e0e0;
                        padding-bottom: 0px;
                    }

                    .section label {
                        font-weight: 600;
                        color: #007bff;
                    }

                    .field-row {
                        display: grid;
                        grid-template-columns: 150px 1fr;
                        align-items: center;
                        gap: 10px 20px;
                        width: 100%;
                    }

                    .field-input {
                        border-bottom: 1px solid #ccc;
                        padding: 0px 8px;
                        width: 100%;
                        min-height: 25px;
                    }

                    .section-title {
                        font-size: 14px;
                        font-weight: 700;
                        color: #007bff;
                        display: block;
                        margin-bottom: 10px;
                        text-align: center;
                    }

                    .button-group {
                        display: flex;
                        gap: 10px;
                        margin: 15px 0;
                    }

                    .error-message {
                            display:flex; 
                            justify-content:center; 
                            width:100%;
                            background-color: #a72828ff;
                            border-radius:8px;
                            padding:12px 16px; 
                            display:flex; 
                            align-items:center; 
                            gap:10px;
                            color: #fcfcfcff; 
                            font-weight:600; 
                            font-size:16px;
                    }

                    .group {
                        display: flex;
                        flex-direction: column;
                        gap: 12px;
                    }

                    label {
                        text-align: right;
                        font-weight: 600;
                        color: #444;
                    }

                    /* 游댳 Ocultar el circulito */
                    .session-type-buttons .o_radio_input {
                        display: none !important;
                    }

                    .session-type-buttons {
                        display: inline-flex;
                        justify-content: center;
                        gap: 15px;
                    }

                    /* 游댳 Estilo base para cada opci칩n */
                    .session-type-buttons .o_radio_item label {
                        display: inline-block;
                        padding: 12px 24px;
                        margin: 5px;
                        border: 2px solid #007bff;
                        border-radius: 25px;
                        cursor: pointer;
                        background-color: #f8f9fa;
                        font-weight: 600;
                        color: #007bff;
                        transition: all 0.2s ease-in-out;
                    }

                    /* 游댳 Hover */
                    .session-type-buttons .o_radio_item label:hover {
                        background-color: #007bff;
                        color: #fff;
                    }

                    /* 游댳 Cuando est치 seleccionado */
                    .session-type-buttons .o_radio_input:checked + label {
                        background-color: #007bff;
                        color: #fff;
                        border-color: #0056b3;
                    }

                    .main-title {
                        display: block;
                        text-align: center;
                        font-size: 22px;
                        font-weight: 800;
                        color: #fff;
                        background: linear-gradient(135deg, #007bff, #0056b3);
                        padding: 10px 24px;
                        border-radius: 12px;
                        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
                        letter-spacing: 1px;
                        margin-bottom: 25px;
                    }

                    .no-dif-check {
                        background: linear-gradient(135deg, #28a745, #218838);
                        color: #fff;
                        font-weight: 700;
                        font-size: 16px;
                        padding: 14px 20px;
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 10px;
                        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }

                    .dif-check {
                        background: linear-gradient(135deg, #dc3545, #a71d2a);
                        color: #fff;
                        font-weight: 700;
                        font-size: 16px;
                        padding: 14px 20px;
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 10px;
                        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }

                </style>

                <sheet>                    
                    <div invisible="desk_id">
                        <span class="error-message">No has vinculado ninguna ventanilla. Ve al men칰 VINCULAR VENTANILLA y hazlo, para que puedas gestionar tu sesi칩n de trabajo.</span>
                    </div>

                    <div class="session-card" invisible="not desk_id">

                        <!-- 游댳 MAIN FIELD -->
                        <div class="section">
                            <span class="main-title">SESI칍N DE ENTRADA/SALIDA</span>
                            <div class="field-row session-type-buttons">
                                <field name="session_type" widget="radio" options="{'horizontal': true}" readonly="id"/>
                            </div>
                        </div>

                        <!-- 游댳 READONLY FIELDS -->
                        <div class="section">
                            <span class="section-title">INFORMACI칍N DE LA SESI칍N</span>
                            <div class="group">

                                <div class="field-row">
                                    <label for="name"/>
                                    <field name="name" readonly="1" class="field-input" force_save="1"/>
                                </div>

                                <div class="field-row">
                                    <label for="user_id"/>
                                    <field name="user_id" force_save="1" options="{'no_create': True, 'no_open': True}" readonly="1" class="field-input"/>
                                </div>

                                <div class="field-row">
                                    <label for="desk_id"/>
                                    <field name="desk_id" force_save="1" options="{'no_open': True}" class="field-input"/>
                                </div>

                                <div class="field-row">
                                    <label for="opening_desk_id"/>
                                    <field name="opening_desk_id" force_save="1" options="{'no_create': True, 'no_open': True}" readonly="1" class="field-input"/>
                                </div>

                                <div class="field-row">
                                    <label for="session_status"/>
                                    <field name="session_status" force_save="1" class="field-input"/>
                                </div>

                                <div class="field-row" invisible="not start_time">
                                    <label for="start_time"/>
                                    <field name="start_time" force_save="1" readonly="1" class="field-input"/>
                                </div>

                                <div class="field-row" invisible="not close_time">
                                    <label for="close_time"/>
                                    <field name="close_time" force_save="1" readonly="1" class="field-input"/>
                                </div>
                                <div class="field-row" invisible="session_type != 'checkin' or not closing_session">
                                    <label for="closing_session"/>
                                    <field name="closing_session" force_save="1" class="field-input" readonly="1"/>
                                </div>
                                <div class="field-row" invisible="session_type != 'checkout' or not session_to_close">
                                    <label for="session_to_close"/>
                                    <field name="session_to_close" force_save="1" class="field-input" readonly="1"/>
                                </div>
                            </div>
                        </div>

                        <!-- 游댳 Checkbalance status -->
                        <div class="section" invisible="not balances_checked_ended or saved_difference_checkbalance_ids">
                            <div style="display:flex; justify-content:center; width:100%; margin-bottom:20px;">
                                <div class="no-dif-check">
                                    <i class="fa fa-check-square"></i>
                                    <span>Arqueo completado sin diferencias</span>
                                </div>
                            </div>
                        </div>
                        <div class="section" invisible="not saved_difference_checkbalance_ids">
                            <div style="display:flex; justify-content:center; width:100%; margin-bottom:20px;">
                                <div class="dif-check">
                                    <i class="fa fa-check-square"></i>
                                    <span>Arqueo completado con diferencias</span>
                                </div>
                            </div>
                            <div>
                                <field name="diff_summary" readonly="1" widget="html" force_save="1"/>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="section">
                        <div class="o_button_box" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;">

                            <!-- Start session -->
                            <div invisible="session_type != 'checkin' or not desk_id or id">
                                <button name="launch_create" string="INICIAR SESI칍N" type="object"
                                    class="btn btn-success"/>
                            </div>

                            <!-- End session -->
                            <div invisible="session_type != 'checkout' or not desk_id or id">
                                <button name="launch_create" string="FINALIZAR SESI칍N" type="object"
                                    class="btn btn-danger"/>
                            </div>

                            <!-- Start entry balance check -->
                            <div invisible="session_type != 'checkin' or not id or opening_desk_id != desk_id or balances_checked_started">
                                <button name="start_checkbalance" string="INICIAR ARQUEO DE ENTRADA" type="object"
                                    class="btn btn-warning"/>
                            </div>

                            <!-- Start exit balance check -->
                            <div invisible="session_type != 'checkout' or not id or opening_desk_id != desk_id or balances_checked_started">
                                <button name="start_checkbalance" string="INICIAR ARQUEO DE SALIDA" type="object"
                                    class="btn btn-warning"/>
                            </div>

                            <!-- Search differences -->
                            <div invisible="not checkbalance_ids or (not pending_checkbalance_ids and not difference_checkbalance_ids)">
                                <button name="search_difference" string="BUSCAR DIFERENCIAS" type="object"
                                    class="btn btn-warning"/>
                            </div>

                            <!-- Confirm balances with differences -->
                            <div invisible="not difference_checkbalance_ids">
                                <button name="confirm_balances" string="CONFIRMAR ARQUEO" type="object"
                                    class="btn btn-danger" confirm="쯉eguro que quieres confirmar el arqueo?"/>
                            </div>

                        </div>
                    </div>

                    <!-- Notebook -->
                    <div>
                        <!-- Balance check -->
                        <notebook invisible="not pending_checkbalance_ids and not difference_checkbalance_ids">
                            <page string="Pendiente de arqueo" invisible="not pending_checkbalance_ids">
                                <field name="pending_checkbalance_ids">
                                    <list editable="top" create="false" delete="false" options="{'no_open': True}">
                                        <field name="name"/>
                                        <field name="session_id" options="{'no_open': True}"/>
                                        <field name="user_id" options="{'no_open': True}"/>
                                        <field name="desk_id" options="{'no_open': True}"/>
                                        <field name="currency_id" options="{'no_open': True}"/>
                                        <field name="physical_balance"/>
                                        <field name="BD_balance"/>
                                        <field name="difference"/>
                                        <field name="checked"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Diferencias en el arqueo" invisible="not difference_checkbalance_ids">
                                <field name="difference_checkbalance_ids">
                                    <list editable="top" create="false" delete="false">
                                        <field name="name"/>
                                        <field name="session_id" options="{'no_open': True}"/>
                                        <field name="user_id" options="{'no_open': True}"/>
                                        <field name="desk_id" options="{'no_open': True}"/>
                                        <field name="currency_id" options="{'no_open': True}"/>
                                        <field name="physical_balance" widget="char"/>
                                        <field name="BD_balance"/>
                                        <field name="difference"/>
                                        <field name="checked"/>
                                    </list>
                                </field>
                            </page>
                        </notebook>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- List view of forexmanager.worksession -->
    <record id="forexmanager_worksession_list_view" model="ir.ui.view">
        <field name="name">ForexManager worksession list view</field>
        <field name="model">forexmanager.worksession</field>
        <field name="arch" type="xml">
            <list delete="0" duplicate="0" decoration-success="desk_id == opening_desk_id" decoration-warning="desk_id != opening_desk_id">
                <field name="id" width="5"/>
                <field name="name" width="400"/>
                <field name="desk_id" width="50" string="Ventanilla/sesi칩n" />
                <field name="opening_desk_id" width="50" string="Ventanilla/arqueo"/>
                <field name="session_type" string="Tipo" width="20"/>
                <field name="session_status" string="Estado" width="20"/>
                <field name="session_to_close" width="100"/>
                <field name="closing_session" width="100"/>
                <field name="start_time" string="Inicio" width="20"/>
                <field name="close_time" string="Cierre" width="20"/>
                <field name="balances_checked_ended" width="30"/>
            </list>
        </field>
    </record>

    <!-- Search view of forexmanager.worksession-->
     <record id="forexmanager_worksession_search_view" model="ir.ui.view">
        <field name="name">ForexManager worksession search view</field>
        <field name="model">forexmanager.worksession</field>
        <field name="arch" type="xml">
            <search>
                <field name="id"/>
                <field name="name"/>
                <field name="desk_id"/>
                <field name="opening_desk_id"/>
                <field name="session_type"/>
                <field name="session_status"/>
                <field name="session_to_close"/>
                <field name="closing_session"/>
            </search>
        </field>
    </record>

    <!-- Action of forexmanager.currency -->
    <record id="forexmanager_worksession_action" model="ir.actions.act_window">
        <field name="name">SESI칍N / ARQUEO</field>
        <field name="res_model">forexmanager.worksession</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[
            ("user_id", "=", uid), 
            ("session_status", "=", "open"),
            ]</field>
    </record>
</odoo>