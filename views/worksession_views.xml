<?xml version="1.0" encoding="UTF-8"?>

<odoo>
    <!-- Form view of forexmanager.worksession -->
    <record id="forexmanager_worksession_form_view" model="ir.ui.view">
        <field name="name">ForexManager worksession form view</field>
        <field name="model">forexmanager.worksession</field>
        <field name="arch" type="xml">
            <form>
                <style>
                    .session-card {
                        flex: 1;
                        min-width: 320px;
                        padding: 15px;
                        background-color: #ffffff;
                        border-radius: 8px;
                        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
                        border-left: 4px solid #007bff;
                        margin-bottom: 15px;
                        max-width: 75%;
                    }

                    .section {
                        margin-bottom: 20px;
                        border-bottom: 1px solid #e0e0e0;
                        padding-bottom: 10px;
                    }

                    .section label {
                        font-weight: 600;
                        color: #007bff;
                    }

                    .field-row {
                        display: flex;
                        gap: 10px;
                        margin-top: 8px;
                        flex-wrap: wrap;
                    }

                    .field-input {
                        border-bottom: 1px solid #ccc;
                        padding: 0px 8px;
                        flex: 1;
                        min-height: 24px;
                        min-width: 100px;
                        margin-bottom: 0px;
                        margin-top: 0px;
                    }

                    .section-title {
                        display: block;
                        font-size: 14px;
                        font-weight: 700;
                        color: #007bff;
                        margin-bottom: 8px;
                    }

                    .button-group {
                        display: flex;
                        gap: 10px;
                        margin: 15px 0;
                    }
                </style>

                <sheet>
                    <h1 class="bg-primary text-white p-2 rounded fs-3">SESIÃ“N DE ENTRADA/SALIDA</h1>
                    
                    <div class="session-card">

                        <!-- ðŸ”¹ Campos principales de acciÃ³n -->
                        <div class="section">
                            <span class="section-title">CAMPOS REQUERIDOS</span>
                            <div class="field-row">
                                <div class="flex-1">
                                    <label for="desk_id"/>
                                    <field name="desk_id" options="{'no_create': True, 'no_open': True}" force_save="1"
                                        class="field-input" readonly="id"/>
                                </div>
                                <div class="flex-1" style="margin-left: 50px;">
                                    <label for="session_type"/>
                                    <field name="session_type" force_save="1" widget="radio" readonly="id"
                                        class="field-input"/>
                                </div>
                            </div>
                        </div>

                        <!-- ðŸ”¹ Campos solo lectura agrupados -->
                        <div class="section">
                            <span class="section-title">INFORMACIÃ“N DE LA SESIÃ“N</span>
                            <div class="field-row" style="display:flex; gap:40px;">

                                <!-- Grupo: Nombre + Estado -->
                                <div class="flex-1" style="display:flex; flex-direction:column; gap:10px;">
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <label for="name"/>
                                        <field name="name" force_save="1" readonly="1" class="field-input"/>
                                    </div>
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <label for="session_status"/>
                                        <field name="session_status" force_save="1" class="field-input"/>
                                    </div>
                                </div>

                                <!-- Grupo: Usuario + Desk apertura -->
                                <div class="flex-1" style="display:flex; flex-direction:column; gap:10px;">
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <label for="user_id"/>
                                        <field name="user_id" options="{'no_create': True, 'no_open': True}"
                                            force_save="1" readonly="1" class="field-input"/>
                                    </div>
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <label for="opening_desk_id"/>
                                        <field name="opening_desk_id" options="{'no_create': True, 'no_open': True}"
                                            force_save="1" readonly="1" class="field-input"/>
                                    </div>
                                </div>

                                <!-- Grupo: Inicio + Cierre -->
                                <div class="flex-1" style="display:flex; flex-direction:column; gap:10px;">
                                    <div style="display:flex; align-items:center; gap:10px;" invisible="not start_time">
                                        <label for="start_time"/>
                                        <field name="start_time" force_save="1" readonly="1" class="field-input" />
                                    </div>
                                    <div style="display:flex; align-items:center; gap:10px;" invisible="not close_time">
                                        <label for="close_time"/>
                                        <field name="close_time" force_save="1" readonly="1" class="field-input" />
                                    </div>
                                </div>
                                <div class="flex-1" style="display:flex; flex-direction:column; gap:10px;">
                                    <div class="flex-1" invisible="session_type != 'checkin' or not closing_session">
                                        <label for="closing_session"/>
                                        <field name="closing_session" force_save="1"
                                            class="field-input"/>
                                    </div>
                                    <div class="flex-1" invisible="session_type != 'checkout' or not session_to_close">
                                        <label for="session_to_close"/>
                                        <field name="session_to_close" force_save="1"
                                            class="field-input"/>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ðŸ”¹ Estado del arqueo -->
                        <div class="section" invisible="not balances_checked_ended">
                            <div style="display:flex; justify-content:center; width:100%;">
                                <div style="background-color:#e6ffed; border:1px solid #28a745; border-radius:8px;
                                            padding:12px 16px; display:flex; align-items:center; gap:10px;">
                                    <span style="color:#155724; font-weight:600; font-size:16px;">
                                        <i class="fa fa-check-square"></i>
                                        ARQUEO COMPLETADO CON Ã‰XITO
                                    </span>
                                </div>
                            </div>
                        </div>


                    </div>

                    <!-- Buttons -->
                    <div class="section">
                        <div class="o_button_box" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;">

                            <!-- Start session -->
                            <div invisible="session_type != 'checkin' or not desk_id or id">
                                <button name="launch_create" string="INICIAR SESIÃ“N" type="object"
                                    class="btn btn-success"/>
                            </div>

                            <!-- End session -->
                            <div invisible="session_type != 'checkout' or not desk_id or id">
                                <button name="launch_create" string="FINALIZAR SESIÃ“N" type="object"
                                    class="btn btn-danger"/>
                            </div>

                            <!-- Start entry balance check -->
                            <div invisible="session_type != 'checkin' or not id or opening_desk_id != desk_id or balances_checked_started">
                                <button name="start_checkbalance" string="INICIAR ARQUEO DE ENTRADA" type="object"
                                    class="btn btn-warning"/>
                            </div>

                            <!-- Start exit balance check -->
                            <div invisible="session_type != 'checkout' or not id or opening_desk_id != desk_id or balances_checked_started">
                                <button name="start_checkbalance" string="INICIAR ARQUEO DE SALIDA" type="object"
                                    class="btn btn-warning"/>
                            </div>

                            <!-- Search differences -->
                            <div invisible="not checkbalance_ids or (not pending_checkbalance_ids and not difference_checkbalance_ids)">
                                <button name="search_difference" string="BUSCAR DIFERENCIAS" type="object"
                                    class="btn btn-warning"/>
                            </div>

                            <!-- Confirm balances with differences -->
                            <div invisible="not difference_checkbalance_ids">
                                <button name="confirm_balances" string="CONFIRMAR ARQUEO" type="object"
                                    class="btn btn-danger" confirm="Â¿Seguro que quieres confirmar el arqueo?"/>
                            </div>

                        </div>
                    </div>

                    <!-- Notebook -->
                    <div>
                        <!-- Balance check -->
                        <notebook invisible="not pending_checkbalance_ids and not difference_checkbalance_ids">
                            <page string="Pendiente de arqueo" invisible="not pending_checkbalance_ids">
                                <field name="pending_checkbalance_ids">
                                    <list editable="top" create="false">
                                        <field name="name"/>
                                        <field name="session_id"/>
                                        <field name="user_id"/>
                                        <field name="desk_id"/>
                                        <field name="currency_id"/>
                                        <field name="physical_balance"/>
                                        <field name="BD_balance"/>
                                        <field name="difference"/>
                                        <field name="checked"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Diferencias en el arqueo" invisible="not difference_checkbalance_ids">
                                <field name="difference_checkbalance_ids">
                                    <list editable="top" create="false">
                                        <field name="name"/>
                                        <field name="session_id"/>
                                        <field name="user_id"/>
                                        <field name="desk_id"/>
                                        <field name="currency_id"/>
                                        <field name="physical_balance" widget="char"/>
                                        <field name="BD_balance"/>
                                        <field name="difference"/>
                                        <field name="checked"/>
                                    </list>
                                </field>
                            </page>
                        </notebook>
                    </div>
                </sheet>
            </form>

        </field>
    </record>


    <!-- Action of forexmanager.currency -->
    <record id="forexmanager_worksession_action" model="ir.actions.act_window">
        <field name="name">SESIÃ“N / ARQUEO</field>
        <field name="res_model">forexmanager.worksession</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[("user_id", "=", uid)]</field>
    </record>
</odoo>